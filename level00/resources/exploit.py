"""Level00 Caesar Cipher Decoder with SSH"""

import string
import subprocess
import sys


def caesar_decrypt(text, shift):
    """Decrypt Caesar cipher."""
    result = ""
    for char in text:
        if char in string.ascii_letters:
            alpha = string.ascii_uppercase if char.isupper() else string.ascii_lowercase
            result += alpha[(alpha.index(char) - shift) % 26]
        else:
            result += char
    return result


def ssh_cmd(host, port, user, pwd, cmd):
    """Execute SSH command via sshpass."""
    try:
        result = subprocess.run(
            ["sshpass", "-p", pwd, "ssh", "-o", "StrictHostKeyChecking=no",
             "-p", str(port), f"{user}@{host}", cmd],
            capture_output=True, text=True, timeout=10
        )
        return result.returncode, result.stdout, result.stderr
    except Exception as e:
        return -1, "", str(e)


def main():
    encoded = "cdiiddwpgswtgt"
    flag00_pwd = caesar_decrypt(encoded, 15)

    print("Level00 Caesar Cipher")
    print(f"Encrypted: {encoded}")
    print(f"Flag00 Password: {flag00_pwd}\n")

    print(f"[*] SSH to flag00@localhost:4242")
    code, out, err = ssh_cmd("localhost", 4242, "flag00", flag00_pwd, "getflag")

    if code == 0 and "token" in out.lower():
        print(f"[+] Success!\n{out}")
        token = out.split(":")[-1].strip()
        print(f"[+] Level00 Token: {token}")
    else:
        print(f"[!] Failed: {err}")
        sys.exit(1)


if __name__ == "__main__":
    main()
